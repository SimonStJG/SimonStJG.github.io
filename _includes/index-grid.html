<div class="index-grid">
  <h1>{{ include.title }}</h1>

  {% for post in include.tags %}
    {% comment %}  Loop indices begin at 1 :(  {% endcomment %}
    {% capture length_mod %}{{ forloop.index | minus: 1 | modulo : 3 }}{% endcapture %}

    {% if length_mod == '0' %}
      <div class="gr-row">
    {% endif %}
        <div class="gr-col overlay-parent">
          <a href="{{ post.url | prepend: site.baseurl }}">
            <img class="opaque-image" src="images/{{ post.thumbnail }}" />
            {% unless post.no-grid-title %}
              <div class="overlay-text-wrapper">
                <h2 class="overlay-text">{{ post.title }}</h2>
              </div>
            {% endunless %}
          </a>
        </div>

    {% if length_mod == '2' %}  
      </div> 
    {% endif %}
    {% if forloop.last %}
      {% if length_mod != '2' %}
        </div>
      {% endif %}
    {% endif %}

  {% endfor %}
</div>